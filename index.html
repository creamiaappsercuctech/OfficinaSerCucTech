<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>OfficinaSerCucTech ‚Äì Percorso Riparazione</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:15px;
}
h1,h2 { color:#1f2a44; }
textarea, button, select {
  width:100%;
  padding:10px;
  margin-top:10px;
  font-size:16px;
}
.box {
  background:#fff;
  padding:15px;
  margin-top:15px;
  border-radius:8px;
}
.step {
  margin-bottom:10px;
}
.controls button {
  width:32%;
  margin-right:2%;
}
.controls button:last-child { margin-right:0; }
</style>
</head>

<body>

<h1>üîß OfficinaSerCucTech</h1>

<div class="box">
  <label><b>Cosa dice il cliente:</b></label>
  <textarea id="clientSays" placeholder="Es: non va la ventola del riscaldamento"></textarea>
  <button onclick="analyze()">üîç Analizza problema</button>
</div>

<div class="box" id="repairBox" style="display:none;">
  <h2>üõ† Percorso di Riparazione</h2>
  <div id="repairSteps"></div>

  <div class="controls">
    <button onclick="playVoice()">‚ñ∂Ô∏è Play</button>
    <button onclick="pauseVoice()">‚è∏ Pausa</button>
    <button onclick="resumeVoice()">‚èØ Riprendi</button>
  </div>
</div>

<script>
let procedures = [];
let utterance = null;
let fullText = "";

// Carica procedures.json
fetch("data/procedures.json")
  .then(r => r.json())
  .then(j => procedures = j.procedures);

function analyze() {
  const text = document.getElementById("clientSays").value.toLowerCase();
  if (!text) return alert("Inserisci il problema del cliente");

  let found = null;

  procedures.forEach(p => {
    p.keywords.forEach(k => {
      if (text.includes(k)) found = p;
    });
  });

  if (!found) return alert("Nessuna procedura trovata");

  showRepair(found);
}

function showRepair(proc) {
  document.getElementById("repairBox").style.display = "block";
  const container = document.getElementById("repairSteps");
  container.innerHTML = "";

  fullText = "Procedura di riparazione. ";

  proc.causes.forEach(c => {
    container.innerHTML += `<h3>üîπ ${c.name}</h3>`;
    fullText += `Causa probabile: ${c.name}. `;

    c.repair.forEach((r, i) => {
      container.innerHTML += `
        <div class="step">
          <b>Step ${i+1}:</b> ${r.t}<br>
          <small>${r.d}</small>
        </div>`;
      fullText += `Passaggio ${i+1}. ${r.t}. ${r.d}. `;
    });
  });
}

// VOCALE
function playVoice() {
  if (!fullText) return;
  speechSynthesis.cancel();
  utterance = new SpeechSynthesisUtterance(fullText);
  utterance.lang = "it-IT";
  utterance.rate = 0.95;
  speechSynthesis.speak(utterance);
}

function pauseVoice() {
  speechSynthesis.pause();
}

function resumeVoice() {
  speechSynthesis.resume();
}
</script>

</body>
</html>
